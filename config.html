<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurar Backend - Rede Social</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-2xl w-full">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2"> Configura√ß√£o Necess√°ria</h1>
            <p class="text-gray-600">Configure a URL do backend para o site funcionar corretamente</p>
        </div>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-blue-700">
                        <strong>Por que isso?</strong> Quando voc√™ exp√µe o site na internet usando ngrok ou localtunnel, 
                        o frontend e backend ficam em URLs diferentes. Voc√™ precisa informar onde o backend est√°.
                    </p>
                </div>
            </div>
        </div>

        <div id="currentConfig" class="mb-6 p-4 bg-gray-50 rounded-lg hidden">
            <h3 class="text-sm font-semibold text-gray-700 mb-2">Configura√ß√£o Atual:</h3>
            <code id="currentUrl" class="text-sm text-blue-600 break-all"></code>
        </div>

        <form id="configForm" class="space-y-6">
            <div>
                <label for="backendUrl" class="block text-sm font-medium text-gray-700 mb-2">
                    URL do Backend:
                </label>
                <input 
                    type="url" 
                    id="backendUrl" 
                    name="backendUrl" 
                    placeholder="https://sua-url-do-ngrok.ngrok.io/api"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    required
                />
                <p class="mt-2 text-sm text-gray-500">
                     Importante: A URL deve terminar com <code class="bg-gray-100 px-2 py-1 rounded">/api</code>
                </p>
            </div>

            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <h4 class="text-sm font-semibold text-yellow-800 mb-2">üìù Exemplos de URLs v√°lidas:</h4>
                <ul class="text-sm text-yellow-700 space-y-1">
                    <li>‚Ä¢ <code class="bg-yellow-100 px-2 py-1 rounded">https://abc123.ngrok.io/api</code></li>
                    <li>‚Ä¢ <code class="bg-yellow-100 px-2 py-1 rounded">https://api-redesocial.loca.lt/api</code></li>
                    <li>‚Ä¢ <code class="bg-yellow-100 px-2 py-1 rounded">http://192.168.1.100:3000/api</code></li>
                    <li>‚Ä¢ <code class="bg-yellow-100 px-2 py-1 rounded">http://localhost:3000/api</code></li>
                </ul>
            </div>

            <div class="flex gap-3">
                <button 
                    type="submit" 
                    class="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition-colors"
                >
                     Salvar e Ir para o Site
                </button>
                <button 
                    type="button" 
                    id="clearBtn"
                    class="px-6 py-3 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50 transition-colors"
                >
                     Limpar
                </button>
            </div>
        </form>

        <div class="mt-8 pt-6 border-t border-gray-200">
            <h3 class="text-sm font-semibold text-gray-700 mb-3">üöÄ Como obter a URL do backend:</h3>
            <ol class="text-sm text-gray-600 space-y-2 list-decimal list-inside">
                <li>Execute <code class="bg-gray-100 px-2 py-1 rounded">./iniciar.sh</code> para iniciar os servidores</li>
                <li>Em outro terminal, execute <code class="bg-gray-100 px-2 py-1 rounded">./expor-internet.sh</code></li>
                <li>Escolha a op√ß√£o 1 (ngrok) ou 2 (localtunnel)</li>
                <li>Copie a URL do <strong>Backend</strong> que aparecer</li>
                <li>Cole aqui e adicione <code class="bg-gray-100 px-2 py-1 rounded">/api</code> no final</li>
            </ol>
        </div>

        <div class="mt-6 text-center">
            <a href="site.html" class="inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 text-sm font-medium transition-all hover:gap-3">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Voltar para o site sem configurar (apenas localhost)
            </a>
        </div>
    </div>

    <script>
        const form = document.getElementById('configForm');
        const backendUrlInput = document.getElementById('backendUrl');
        const clearBtn = document.getElementById('clearBtn');
        const currentConfig = document.getElementById('currentConfig');
        const currentUrl = document.getElementById('currentUrl');

        // Carrega configura√ß√£o atual
        const savedUrl = localStorage.getItem('BACKEND_URL');
        if (savedUrl) {
            currentConfig.classList.remove('hidden');
            currentUrl.textContent = savedUrl;
            backendUrlInput.value = savedUrl;
        }

        // Salva configura√ß√£o
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            let url = backendUrlInput.value.trim();
            
            // Remove barra final se houver
            url = url.replace(/\/$/, '');
            
            // Verifica se termina com /api
            if (!url.endsWith('/api')) {
                if (confirm('A URL n√£o termina com "/api". Deseja adicionar automaticamente?')) {
                    url += '/api';
                    backendUrlInput.value = url;
                }
            }

            // Salva
            localStorage.setItem('BACKEND_URL', url);
            
            // Feedback visual
            const btn = form.querySelector('button[type="submit"]');
            const originalText = btn.textContent;
            btn.textContent = ' Salvo!';
            btn.disabled = true;
            
            setTimeout(() => {
                window.location.href = 'site.html';
            }, 1000);
        });

        // Limpa configura√ß√£o
        clearBtn.addEventListener('click', () => {
            if (confirm('Tem certeza que deseja limpar a configura√ß√£o?')) {
                localStorage.removeItem('BACKEND_URL');
                backendUrlInput.value = '';
                currentConfig.classList.add('hidden');
                alert(' Configura√ß√£o limpa! Ser√° usado localhost:3000 por padr√£o.');
            }
        });

        // Auto-detecta se est√° em um tunnel
        if (window.location.hostname.includes('ngrok') || 
            window.location.hostname.includes('loca.lt') ||
            window.location.hostname.includes('serveo') ||
            window.location.hostname.includes('localhost.run')) {
            
            // Sugere URL baseada no hostname do frontend
            const suggestedUrl = `${window.location.protocol}//api-${window.location.host}/api`;
            
            if (!savedUrl && confirm('Detectamos que voc√™ est√° usando um tunnel!\n\nURL sugerida do backend:\n' + suggestedUrl + '\n\nDeseja usar esta URL?')) {
                backendUrlInput.value = suggestedUrl;
            }
        }
    </script>
</body>
</html>
